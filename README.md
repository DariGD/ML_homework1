# ML_homework1
Результаты выполнения ДЗ по теме Regression with inference base

### Часть 1. EDA датасета с ценами на автомобиль и их признаками 
- [x] - оценить входные данные на трейн и тест, определить какие столбцы необходимо предобработать (те, что имеют строковый формат в виде значения с единицами измерения)
- [x] - предобработка столбцов с единицами измерения - удаление единиц измерения, в столбце остались только числовые значения
- [ ] - предобработка столбца torque - не удалась, но и в базовом ДЗ не обязательна
- [x] - определить наличие дублей и пропусков - пропуски заполнить медианным значением по трейну, дубли удалить
- [x] - числовые значения привести к типу данных int и float
- [x] - построить попарные графики зависимости параметров и целевой переменной - определить корреляцию (подтвердить данный факт построением тепловой карты и матрицей коэффициентов корреляции). С таргетом (цена автомобиля) наиболее всего коррелирует признак max power.
- [x] - дополнительно оценила распределение тагрета и пришла к выводу, что его лучше всего логарифировать для полуечния нормального распределения
      
### Часть 2. Построение моделей 
- [x] - обучение и предикт обычной модели линейной регрессси на вещественных признаках:

|Метрика|Значение|
|---|---|
|MSE train|116873522067|
|MSE test |254290302631|
|r2 train|0.59226|
|r2 test|0.55762|


- [x] - применеине StandartScaler - не дало улучшений по показателям метрик. Можно было бы еще попробовать MinMaxScaler (в работе не проводилось)
- [x] - применение модели с L1-регуляризацией и проведения кросс-валидации на 10 фолдах: был определен оптимальный гиперпараметр альфа 26609, занулилось три веса (самые маленькие по модулю изначально) - mileage,	engine, seats


|Метрика|Значение|
|---|---|
|MSE train|116873522067|
|MSE test |254290302631|
|r2 train|0.59226|
|r2 test|0.55762|


- [x] - применение модели ElasticNet c кросс-валидацией на 10 фолдах для подбора гиперпараметров альфа и l1-ratio (комбинация параметров L1 и L2 регуляризации). Удалось подобрать лучшие параметры, но качество модели на разбиении на трейн и тест не улучшилось. Гиперпараметры 'alpha': 0.9499999999999998, 'l1_ratio': 0.8500000000000003
### Часть 3. Построение модели на вещественных и категориальных фичах
- [x] - применен метод OHE для обработки категориальных признаков (обучен на трейне и применен к трейн и тесту)
- [x] - построена модель Ridge, проведена кросс-валидация для определения лучшего гиперпараметра альфа (630) - метрики улучшились на трейне, но разрыв между трейн и тест стал больше
      
|Метрика|Значение|
|---|---|
|MSE train|96669800282|
|MSE test |236658515520|
|r2 train|0.66275|
|r2 test|0.58830|
      
### Часть 4. Финальные решения по модели
- [x] - создана бизнес-метрика, которая среди всех предсказанных цен на авто показывает долю прогнозов, отличающихся от реальных цен на эти авто не более чем на 10%
- [x] - на ее основании определено, что лучшая модель - это ElasticNet c подобранными гиперпарамтерами выше. Бизнес метрика на трейн:22.47% Бизнес метрика на тест: 26.30%. Все еще очень плохие показатели
- [x] - модель со всеми характеристиками сохранена в pkl файл (https://github.com/DariGD/ML_homework1/blob/5964206bb6208447bd20f3f54fe55fc94bb3ad8c/model_data.pkl)
### Часть 5. FastAPI
С помощью FastAPI реализован сервис с двумя "ручками" (файл с реализацией сервиса https://github.com/DariGD/ML_homework1/blob/a9318282067c64652c2849eb73fe96ccce17dcf7/main.py):

1) на вход в формате json подаются признаки одного объекта, на выходе сервис выдает предсказанную стоимость машины. Пример работы сервиса ниже (реализовано через post)
   ![Image alt](https://github.com/user-attachments/assets/0078dbaa-8dff-45c8-91c6-5a0e19818ab5)

2) на вход подается csv-файл с признаками тестовых объектов, на выходе получаем файл с +1 столбцом - предсказаниями на этих объектах
   ![Image alt](https://github.com/user-attachments/assets/d192624e-e8dc-47a9-afe4-9e0292c1450f)
Скрин из ноутбука с выводом csv файла на входе и полученный csv файл на выходе
![Image alt](https://github.com/user-attachments/assets/4990f015-e38f-4c8e-a973-32686cdb97ea)


#### ВЫВОДЫ 
1) Построена модель линейной регрессии для предсказания стомости автомобиля, исходя из его характеристик (признаки). Этапы предобработки данных и реализация каждого шага подробно отражена в ноутбуке
https://github.com/DariGD/ML_homework1/blob/a9318282067c64652c2849eb73fe96ccce17dcf7/%D0%93%D0%B0%D0%B9%D0%B4%D1%83%D0%BA%D0%BE%D0%B2%D0%B0_%D1%84%D0%B8%D0%BD%D0%B0%D0%BB__AI_HW1_Regression_with_inference_base_ipynb_.ipynb
2) На сырых входных данных проведен однофакторный анализ признаков с помощью встроенного дашборда (распределение признаков и тагрета, оценка их значений, а также типа данных). Помогает на первый взгляд оценить ситуацию и понять первые действия по предобработке данных (в том числе в части первичного анализа выбросов - в данной работе от выбросов не избавлялись). С результатами можно ознакомить в дашборде по ссылке
   https://github.com/DariGD/ML_homework1/blob/a9318282067c64652c2849eb73fe96ccce17dcf7/Rep.html
3) Разработан сервис для предсказывания стоимости одного автомобиля и реализована структура для обработки массива входных данных (файл выше)

#### ПРОБЛЕМЫ
1) Не удалось существенно повысить качество предсказывания (r2 на уровне 0,6). Стоит еще подумать над типом модели и возможно добавлением доп. фичей
2) Бизнес-метрика также крайне мала (около 22% верных предсказываний в диапазоне +- от реальной стоимости а/м). На трейне показала себя лучше - 26% (возможно в трейн и тест попали разные классы признаков, из-за чего модель не верно обучалась)
3) Возможно стоит тестировать модель и оценивать метрики с использовнием разбиения на фолды (для определения средней метрики и степени воспроизводимости результатов), чистить данные от выбросов, откидывать признаки/добавлтяь новые
   
   

